;
;### 함수 ###################################
;이하의 함수는 「에이키님 말」내의 「M_KOJO_K30_함수·설교 라이브러리」를 빌린 것입니다
;코마치 말작자가 작성한 것은 아니기 때문에 주의해 주세요
;동라이브러리의 이용에 관해서는, 에이키님 말의 작자님의 라이센스에 준합니다

;배차여기로부터
;==================================================

;==================================================
;MASTER의 연인이 그 자리에 있을지 어떨지 돌려주는 식 나카노세키수
;이것은 힘 기술로 어떻게든 실장할 수 있던 같기 때문에, 사용하지 않아도 문제 없는 생각이 든다(코마치 말작자)
;그렇지만 절대 여기의 것이 스마트
;=-1 코마치가 연인 =0원으로부터 연인 없음 =1 그 자리에 없다 =2 연인과 동석
@K76_FIND_LOVER()
#FUNCTION
SIF TALENT:MASTER:연인 == 0
	RETURNF 0
SIF TALENT:연인
	RETURNF -1
LOCAL = TALENT:MASTER:연인
SIF CFLAG:LOCAL:현재위치 == CFLAG:MASTER:현재위치
	RETURNF 2
RETURNF 1
;==================================================


;==================================================
;같은 방의 캐릭터를 줍는 식 나카노세키수. 찾는 순위는[연인]가져→면간→TARGET내 랜덤
;앨리스 말의 함수빌려 평 아야화한 에이키 말의 함수를 빌렸습니다. 즉 환 덥썩 먹음
;환카피 하는 이외의 기술이 없기 때문에 선인들의 지혜에 감사를 계속 할 수 밖에 없다
@K76_FIND_AROUND()
#FUNCTION
#DIM 면간, 3 = 30, 43, 1
#DIM 총인원수
#DIM 추첨
#LOCALSIZE 20
;코마치의 면간은 3명, 에이키>카센>레이무의 순서에(마음대로) 설정
;일단 이유로서는
;에이키→말하지 않는 것이 좋음
;카센→가시나무 명인으로 관련이 많았다
;레이무→가시나무 명인으로 레이무가 어떤 인물이나 생각보다는 자세하게 말하고 있던 묘사가 있었다(라고 느꼈다)
;명계조라든지 3월정령 코믹으로 교류 있었다나 개 있는이나, 라고 하는 (분)편도 있겠지만 우선 말에 관계할 것 같은 캐릭터 우선으로 픽업
VARSET LOCAL
추첨 = 0
총인원수 = GET_TARGETNUM() 
;방에 한사람이라면 당연히 0
SIF 총인원수 == 1
	RETURNF 0
;[연인]소유가 있으면 우선해 ID를 돌려준다
SIF K76_FIND_LOVER() == 2
	RETURNF TALENT:MASTER:연인
;면간 우선도순에 현재위치를 조사 MASTER와 같으면 ID를 돌려준다
FOR COUNT, 0, 2
	SIF CFLAG:(면간:COUNT):현재위치 == CFLAG:MASTER:현재위치
		RETURNF 면간:COUNT
NEXT
;면간이 없으면 동실[同室]의 TARGET_ID전부를 줍는다
FOR COUNT, 1, 총인원수 + 1
	;지옥의 단두대 with 제로니모 상태를 막기 위해 말주는 스킵
	SIF TARGET:COUNT == TARGET:0
		CONTINUE
	;MASTER와 난처하면의 현재위치에 없으면 스킵
	SIF (CFLAG:(TARGET:COUNT):현재위치 != CFLAG:MASTER:현재위치) || (CFLAG:(TARGET:COUNT):현재위치 != CFLAG:76:현재위치)
		CONTINUE
	;배열의 카운트는 별개로 취하면서 대입
	LOCAL:추첨 = TARGET:COUNT
	추첨 ++
NEXT
;추첨해 ID를 결정
RETURNF LOCAL:(RAND(추첨))
;==================================================


;==================================================
;술주정꾼도를 숫자로 돌려주는 식 나카노세키수
;=0 맹숭맹숭한 얼굴 =1술기운 =2 주정꾼 3=곤드레만드레
@K76_DRUNK()
#FUNCTION
SIF BASE:76:술기운 <=  2
	RETURNF 0
SELECTCASE BASE:76:술기운
	;곤드레만드레
	CASE IS > (MAXBASE:76:술기운 / 10) * 8
		RETURNF 3
	;주정꾼
	CASE IS > (MAXBASE:76:술기운 / 10) * 5
		RETURNF 2
	;술기운
	CASE IS <=  (MAXBASE:76:술기운 / 10) * 5
		RETURNF 1
ENDSELECT
;==================================================
;배차 여기까지

;==================================================
;본체 함수를 가공해 자작 함수에
;==================================================
;발기 상태를 숫자로 돌려주는 식 나카노세키수
;=0 통상 = 1봉긋 = 2펄떡펄떡 =3 Erection!!
@K76_발기()
#FUNCTION
#DIM CHARA
IF BASE:CHARA:발기 == MAXBASE:CHARA:발기
	RETURNF 3
ELSEIF BASE:CHARA:발기 >=  1000
	RETURNF 2
ELSEIF BASE:CHARA:발기 >=  500
	RETURNF 1
ELSE
	RETURNF 0
ENDIF
